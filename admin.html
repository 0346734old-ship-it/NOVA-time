<!DOCTYPE html>
<html lang="en">
<head>
  <!-- Firebase App (the core Firebase SDK) -->
<script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>

<!-- Add Firebase products you want to use -->
<script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-firestore-compat.js"></script>

  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Admin Panel - NOVA Racing</title>
  <link rel="stylesheet" href="css/styles.css" />
  <style>
    body {
      font-family: 'Segoe UI', sans-serif;
      padding: 1rem;
      background-color: #f9f9f9;
    }

    .header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      flex-wrap: wrap;
    }

    .logo-container {
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .logo-container img {
      height: 40px;
    }

    h1 {
      font-size: 1.5rem;
      margin: 0;
    }

    button {
      padding: 0.5rem 1rem;
      border: none;
      background-color: #007bff;
      color: white;
      border-radius: 5px;
      cursor: pointer;
      margin: 0.25rem;
    }

    button:hover {
      background-color: #0056b3;
    }

    input {
      padding: 0.5rem;
      margin: 0.25rem 0;
      width: 100%;
      max-width: 300px;
      box-sizing: border-box;
    }

    ul {
      list-style: none;
      padding: 0;
    }

    li {
      background: white;
      margin: 0.5rem 0;
      padding: 0.5rem;
      border-radius: 8px;
      box-shadow: 0 1px 3px rgba(0,0,0,0.1);
    }

    .section {
      margin-top: 2rem;
    }

    .timesheet-entry {
      display: flex;
      align-items: center;
      justify-content: space-between;
      flex-wrap: wrap;
      gap: 0.5rem;
    }

    @media (max-width: 600px) {
      .timesheet-entry {
        flex-direction: column;
        align-items: flex-start;
      }
    }
  </style>
</head>
<body>
  <div class="header">
    <div class="logo-container">
      <img src="images/logo.png" alt="NOVA Racing Logo" />
      <h1>NOVA Racing Admin</h1>
    </div>
    <button onclick="logout()">Logout</button>
  </div>

  <div class="section">
    <h2>Create New User</h2>
    <input type="text" id="newUsername" placeholder="Username" />
    <input type="password" id="newPassword" placeholder="Password" />
    <button onclick="createUser()">Create User</button>
    <p id="errorMsg" style="color: red;"></p>
  </div>

  <div class="section">
    <h2>All Users</h2>
    <ul id="userList"></ul>
  </div>

  <div class="section" id="timesheetView" style="display:none;">
    <h2 id="viewingUser">Timesheets</h2>
    <label><input type="checkbox" id="selectAllCheckbox" /> Select All</label>
    <ul id="userTimesheets"></ul>
    <button id="deleteSelectedBtn">Delete Selected</button>
    <button onclick="showUserList()">Back</button>
  </div>

  <div class="section">
    <h2>Change Admin Password</h2>
    <input type="password" id="adminNewPass" placeholder="New Password" />
    <button onclick="changeAdminPassword()">Change Password</button>
    <p id="adminPassMsg"></p>
  </div>

  <script>
    const users = JSON.parse(localStorage.getItem('users') || '{}');
    const timesheets = JSON.parse(localStorage.getItem('timesheets') || '{}');
    const loggedInUser = localStorage.getItem('loggedInUser');

    if (loggedInUser !== 'admin') {
      window.location.href = 'login.html';
    }

    const userListUl = document.getElementById('userList');
    const timesheetView = document.getElementById('timesheetView');
    const viewingUserH2 = document.getElementById('viewingUser');
    const userTimesheetsUl = document.getElementById('userTimesheets');
    const selectAllCheckbox = document.getElementById('selectAllCheckbox');
    const deleteSelectedBtn = document.getElementById('deleteSelectedBtn');

    function saveUsers() {
      localStorage.setItem('users', JSON.stringify(users));
    }

    function saveTimesheets() {
      localStorage.setItem('timesheets', JSON.stringify(timesheets));
    }

    function logout() {
      localStorage.removeItem('loggedInUser');
      window.location.href = 'login.html';
    }

    function createUser() {
      const newUsername = document.getElementById('newUsername').value.trim();
      const newPassword = document.getElementById('newPassword').value.trim();
      const errorMsg = document.getElementById('errorMsg');

      if (!newUsername || !newPassword) {
        errorMsg.textContent = 'Username and password required.';
        return;
      }

      if (users[newUsername]) {
        errorMsg.textContent = 'User already exists.';
        return;
      }

      users[newUsername] = newPassword;
      timesheets[newUsername] = [];
      saveUsers();
      saveTimesheets();
      showUserList();
      document.getElementById('newUsername').value = '';
      document.getElementById('newPassword').value = '';
      errorMsg.textContent = '';
    }

    function showUserList() {
      timesheetView.style.display = 'none';
      userListUl.innerHTML = '';

      for (const user in users) {
        const li = document.createElement('li');
        li.innerHTML = `
          <strong>${user}</strong>
          ${user !== 'admin' ? `
            <button onclick="viewTimesheets('${user}')">View Timesheets</button>
            <button onclick="changeUserPassword('${user}')">Change Password</button>
            <button onclick="deleteUser('${user}')">Delete</button>
          ` : '(admin)'}
        `;
        userListUl.appendChild(li);
      }
    }

    function viewTimesheets(user) {
      timesheetView.style.display = 'block';
      viewingUserH2.textContent = `Timesheets for ${user}`;
      userTimesheetsUl.innerHTML = '';

      (timesheets[user] || []).forEach((entry, index) => {
        const li = document.createElement('li');
        li.classList.add('timesheet-entry');
        li.innerHTML = `
          <input type="checkbox" class="entryCheckbox" data-index="${index}">
          ${entry.date} â€” ${entry.startTime} to ${entry.endTime}
          <div>
            <button onclick="editEntry('${user}', ${index})">Edit</button>
            <button onclick="deleteEntry('${user}', ${index})">Delete</button>
          </div>
        `;
        userTimesheetsUl.appendChild(li);
      });

      selectAllCheckbox.checked = false;
    }

    function editEntry(user, index) {
      const entry = timesheets[user][index];
      const newDate = prompt('Edit Date:', entry.date);
      if (!newDate) return;
      const newStart = prompt('Edit Start Time:', entry.startTime);
      if (!newStart) return;
      const newEnd = prompt('Edit End Time:', entry.endTime);
      if (!newEnd) return;

      timesheets[user][index] = { date: newDate, startTime: newStart, endTime: newEnd };
      saveTimesheets();
      viewTimesheets(user);
    }

    function deleteEntry(user, index) {
      if (confirm('Delete this entry?')) {
        timesheets[user].splice(index, 1);
        saveTimesheets();
        viewTimesheets(user);
      }
    }

    selectAllCheckbox.addEventListener('change', () => {
      document.querySelectorAll('.entryCheckbox').forEach(cb => {
        cb.checked = selectAllCheckbox.checked;
      });
    });

    deleteSelectedBtn.addEventListener('click', () => {
      const user = viewingUserH2.textContent.replace('Timesheets for ', '');
      const indexes = Array.from(document.querySelectorAll('.entryCheckbox:checked'))
        .map(cb => parseInt(cb.dataset.index)).sort((a, b) => b - a);

      indexes.forEach(i => timesheets[user].splice(i, 1));
      saveTimesheets();
      viewTimesheets(user);
    });

    function changeUserPassword(user) {
      const newPass = prompt(`Enter new password for ${user}:`);
      if (newPass) {
        users[user] = newPass;
        saveUsers();
        alert('Password updated.');
      }
    }

    function deleteUser(user) {
      if (confirm(`Delete user "${user}"?`)) {
        delete users[user];
        delete timesheets[user];
        saveUsers();
        saveTimesheets();
        showUserList();
      }
    }

    function changeAdminPassword() {
      const newPass = document.getElementById('adminNewPass').value.trim();
      const msg = document.getElementById('adminPassMsg');
      if (!newPass) {
        msg.textContent = 'Password cannot be empty.';
        return;
      }
      users['admin'] = newPass;
      saveUsers();
      msg.textContent = 'Password changed.';
      document.getElementById('adminNewPass').value = '';
    }

    showUserList();
  </script>
</body>
</html>

