<!DOCTYPE html>
<html lang="en">
<head>
  <!-- Firebase SDK scripts -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore.js"></script>

<script>
  // Your Firebase config (replace with your keys)
  const firebaseConfig = {
    apiKey: "AIzaSyBCb1mVh5eZdzLn5oYvTO8F9BOVFAKYh2U",
    authDomain: "nova-8b407.firebaseapp.com",
    projectId: "nova-8b407",
    storageBucket: "nova-8b407.firebasestorage.app",
    messagingSenderId: "1046397555152",
    appId: "1:1046397555152:web:eace78ab28fead1aae69d5",
    measurementId: "G-75PHS2PHY6"
  };

  // Initialize Firebase app
  const app = firebase.initializeApp(firebaseConfig);
  const auth = firebase.auth();
  const db = firebase.firestore();
</script>

  <!-- Firebase App (the core Firebase SDK) -->
<script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>

<!-- Add Firebase products you want to use -->
<script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-firestore-compat.js"></script>

  <!-- Manifest -->
<link rel="manifest" href="manifest.json" />

<!-- iOS Splash and App Settings -->
<meta name="apple-mobile-web-app-capable" content="yes" />
<meta name="apple-mobile-web-app-status-bar-style" content="default" />
<meta name="apple-mobile-web-app-title" content="NOVA Racing" />
<link rel="apple-touch-icon" href="images/logo.png" />

<!-- Viewport for iOS scaling -->
<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />

  <meta charset="UTF-8" />
  <title>NOVA Racing - Timesheet</title>
  <link rel="stylesheet" href="css/styles.css" />
  <link rel="manifest" href="manifest.json" />
  <meta name="theme-color" content="#ffffff" />
  <style>
    .logo-container {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 1rem;
      margin-bottom: 1rem;
    }
    .logo-container img {
      height: 50px;
      width: 50px;
    }
    .logo-container h1 {
      font-size: 1.8rem;
      font-weight: bold;
    }
    .timesheet-entry {
      display: flex;
      justify-content: space-between;
      background-color: #f5f5f5;
      padding: 10px;
      border-radius: 5px;
      margin: 5px 0;
    }
    .timesheet-entry button {
      margin-left: 5px;
    }
    .logout-btn {
      position: absolute;
      top: 15px;
      right: 20px;
      padding: 8px 16px;
    }
  </style>
</head>
<body>
  <button class="logout-btn" onclick="logout()">Logout</button>

  <div class="container">
    <div class="logo-container">
      <img src="images/logo.png" alt="NOVA Racing Logo">
      <h1>NOVA Racing</h1>
    </div>

    <h2>Timesheet</h2>
    <form id="timesheetForm">
      <input type="date" id="date" required />
      <input type="time" id="startTime" required />
      <input type="time" id="endTime" required />
      <button type="submit">Add Entry</button>
    </form>

    <ul id="timesheetList"></ul>
  </div>

  <script>
    const loggedInUser = localStorage.getItem('loggedInUser');
    if (!loggedInUser || loggedInUser === 'admin') {
      window.location.href = 'login.html';
    }

    const timesheets = JSON.parse(localStorage.getItem('timesheets') || '{}');
    if (!timesheets[loggedInUser]) {
      timesheets[loggedInUser] = [];
    }

    const form = document.getElementById('timesheetForm');
    const list = document.getElementById('timesheetList');

    function saveTimesheets() {
      localStorage.setItem('timesheets', JSON.stringify(timesheets));
    }

    function renderTimesheet() {
      list.innerHTML = '';
      timesheets[loggedInUser].forEach((entry, index) => {
        const li = document.createElement('li');
        li.className = 'timesheet-entry';
        li.innerHTML = `
          <span>${entry.date}: ${entry.startTime} - ${entry.endTime}</span>
          <span>
            <button onclick="editEntry(${index})">Edit</button>
            <button onclick="deleteEntry(${index})">Delete</button>
          </span>
        `;
        list.appendChild(li);
      });
    }

    function logout() {
      localStorage.removeItem('loggedInUser');
      window.location.href = 'login.html';
    }

    function editEntry(index) {
      const entry = timesheets[loggedInUser][index];
      const newDate = prompt("Edit Date", entry.date);
      const newStart = prompt("Edit Start Time", entry.startTime);
      const newEnd = prompt("Edit End Time", entry.endTime);

      if (newDate && newStart && newEnd) {
        timesheets[loggedInUser][index] = {
          date: newDate,
          startTime: newStart,
          endTime: newEnd
        };
        saveTimesheets();
        renderTimesheet();
      }
    }

    function deleteEntry(index) {
      if (confirm("Are you sure you want to delete this entry?")) {
        timesheets[loggedInUser].splice(index, 1);
        saveTimesheets();
        renderTimesheet();
      }
    }

    form.addEventListener('submit', (e) => {
      e.preventDefault();
      const date = document.getElementById('date').value;
      const startTime = document.getElementById('startTime').value;
      const endTime = document.getElementById('endTime').value;

      timesheets[loggedInUser].push({ date, startTime, endTime });
      saveTimesheets();
      form.reset();
      renderTimesheet();
    });

    renderTimesheet();

    // PWA support
    if ('serviceWorker' in navigator) {
      navigator.serviceWorker.register('service-worker.js');
    }
  </script>
</body>
</html>
